import{S as e,i as s,s as t,B as n,M as a,z as o,a as c,D as r,g as l,E as i,j as $,F as d,G as f,H as g,f as m,l as u,o as p,ad as h,e as y,t as _,C as N,c as w,b,d as v,h as x,k as S,x as F,I as k,J as j,q as A,N as B,p as C,v as D,n as M,u as R}from"./client.877fc7f9.js";function U(e){let s,t;return{c(){s=y("div"),t=_("Nothing to Sync."),this.h()},l(e){s=w(e,"DIV",{style:!0});var n=b(s);t=v(n,"Nothing to Sync."),n.forEach(m),this.h()},h(){D(s,"margin","1em 0em")},m(e,n){$(e,s,n),S(s,t)},p:M,i:M,o:M,d(e){e&&m(s)}}}function E(e){let s,t;return s=new R({props:{a:{grow:!0},$$slots:{default:[L]},$$scope:{ctx:e}}}),s.$on("click",e[5]),{c(){o(s.$$.fragment)},l(e){r(s.$$.fragment,e)},m(e,n){i(s,e,n),t=!0},p(e,t){const n={};1024&t&&(n.$$scope={dirty:t,ctx:e}),s.$set(n)},i(e){t||(d(s.$$.fragment,e),t=!0)},o(e){f(s.$$.fragment,e),t=!1},d(e){g(s,e)}}}function I(e){let s,t;return s=new R({props:{a:{grow:!0},$$slots:{default:[P]},$$scope:{ctx:e}}}),s.$on("click",e[6]),{c(){o(s.$$.fragment)},l(e){r(s.$$.fragment,e)},m(e,n){i(s,e,n),t=!0},p(e,t){const n={};1024&t&&(n.$$scope={dirty:t,ctx:e}),s.$set(n)},i(e){t||(d(s.$$.fragment,e),t=!0)},o(e){f(s.$$.fragment,e),t=!1},d(e){g(s,e)}}}function L(e){let s;return{c(){s=_("Sync All")},l(e){s=v(e,"Sync All")},m(e,t){$(e,s,t)},d(e){e&&m(s)}}}function P(e){let s;return{c(){s=_("Clear Space")},l(e){s=v(e,"Clear Space")},m(e,t){$(e,s,t)},d(e){e&&m(s)}}}function V(e){let s,t,n,a,o,r,i,g,u,p,h,A,B,C,D,M,R,L,P,V,q,z,G,H,J,T,K=(e[0].matching_files||"None")+"",O=(e[0].differences_found||"None")+"",Q=(e[0].files_missing||"None")+"",W=(e[1]?e[1].length:"N/A")+"",X=(e[0].errors_while_checking||"None")+"";const Y=[I,E,U],Z=[];function ee(e,s){return e[0].differences_found||e[0].errors_while_checking||!e[2]||e[0].files_missing||0==e[1].length?0!=e[1].length?1:2:0}return G=ee(e),H=Z[G]=Y[G](e),{c(){s=y("div"),t=_("Used Memory: "),n=_(e[3]),a=y("br"),o=_("\n    Available Memory: "),r=_(e[4]),i=y("br"),g=_("\n    Synced Files: "),u=_(K),p=y("br"),h=_("\n    Unsynced Files: "),A=_(O),B=_(" ("),C=_(Q),D=_(") "),M=y("br"),R=_("\n    Local Files: "),L=_(W),P=y("br"),V=_(" \n    Notices: "),q=_(X),z=c(),H.c(),J=N(),this.h()},l(c){s=w(c,"DIV",{class:!0});var $=b(s);t=v($,"Used Memory: "),n=v($,e[3]),a=w($,"BR",{}),o=v($,"\n    Available Memory: "),r=v($,e[4]),i=w($,"BR",{}),g=v($,"\n    Synced Files: "),u=v($,K),p=w($,"BR",{}),h=v($,"\n    Unsynced Files: "),A=v($,O),B=v($," ("),C=v($,Q),D=v($,") "),M=w($,"BR",{}),R=v($,"\n    Local Files: "),L=v($,W),P=w($,"BR",{}),V=v($," \n    Notices: "),q=v($,X),$.forEach(m),z=l(c),H.l(c),J=N(),this.h()},h(){x(s,"class","pb1")},m(e,c){$(e,s,c),S(s,t),S(s,n),S(s,a),S(s,o),S(s,r),S(s,i),S(s,g),S(s,u),S(s,p),S(s,h),S(s,A),S(s,B),S(s,C),S(s,D),S(s,M),S(s,R),S(s,L),S(s,P),S(s,V),S(s,q),$(e,z,c),Z[G].m(e,c),$(e,J,c),T=!0},p(e,s){(!T||8&s)&&F(n,e[3]),(!T||16&s)&&F(r,e[4]),(!T||1&s)&&K!==(K=(e[0].matching_files||"None")+"")&&F(u,K),(!T||1&s)&&O!==(O=(e[0].differences_found||"None")+"")&&F(A,O),(!T||1&s)&&Q!==(Q=(e[0].files_missing||"None")+"")&&F(C,Q),(!T||2&s)&&W!==(W=(e[1]?e[1].length:"N/A")+"")&&F(L,W),(!T||1&s)&&X!==(X=(e[0].errors_while_checking||"None")+"")&&F(q,X);let t=G;G=ee(e),G===t?Z[G].p(e,s):(k(),f(Z[t],1,1,()=>{Z[t]=null}),j(),H=Z[G],H||(H=Z[G]=Y[G](e),H.c()),d(H,1),H.m(J.parentNode,J))},i(e){T||(d(H),T=!0)},o(e){f(H),T=!1},d(e){e&&m(s),e&&m(z),Z[G].d(e),e&&m(J)}}}function q(e){let s,t,u,p;return s=new n({}),u=new a({props:{a:{grow:!0},className:"p06",$$slots:{default:[V]},$$scope:{ctx:e}}}),{c(){o(s.$$.fragment),t=c(),o(u.$$.fragment)},l(e){r(s.$$.fragment,e),t=l(e),r(u.$$.fragment,e)},m(e,n){i(s,e,n),$(e,t,n),i(u,e,n),p=!0},p(e,[s]){const t={};1055&s&&(t.$$scope={dirty:s,ctx:e}),u.$set(t)},i(e){p||(d(s.$$.fragment,e),d(u.$$.fragment,e),p=!0)},o(e){f(s.$$.fragment,e),f(u.$$.fragment,e),p=!1},d(e){g(s,e),e&&m(t),g(u,e)}}}function z(e,s,t){let n;u(e,C,e=>t(8,n=e));let a,o,c,{data:r={}}=s,l=[],i=!1;function $(){return new Promise((e,s)=>{A.set({type:"wait",message:"Checking Drive"}),B.get("/sync?as=json",{}).then(s=>{t(0,r=s.data),A.set(null),e(),B.get("/usb/recordings?as=json").then(e=>{t(1,l=e.data),console.log("[sync/index.svelte] 🗄✅  listed local files:",l.length),t(2,i=!0)}).catch(e=>{console.log("[sync/index.svelte] 🗄❌  could not list local files:",e)})}).catch(e=>{A.set({type:"error",...e.response.data}),s()})})}return p(async()=>{$()}),e.$$set=e=>{"data"in e&&t(0,r=e.data)},e.$$.update=()=>{256&e.$$.dirty&&t(7,a=n.drives.find(e=>"/home/pi/pdac/usb"==e._mounted)||{}),128&e.$$.dirty&&t(3,o=h(1e3*a._used).auto+" ("+a._capacity+")"),128&e.$$.dirty&&t(4,c=h(1e3*a._available).auto)},[r,l,i,o,c,function(){A.set({type:"wait",message:"Syncing Files<br />Please wait..."}),B.post("/sync?as=json",{}).then(e=>{$().finally(()=>{A.set({type:"success",message:e.data,actions:[["Sessions","/session"],["Close","/sync"]]})})}).catch(e=>{A.set({type:"error",...e.response.data})})},function(){A.set({type:"wait",message:"Deleting Local Files"}),B.post("/sync/clearup?as=json",{}).then(e=>{console.log(e),setTimeout(()=>{$().finally(()=>{A.set(null)})},1e3)}).catch(e=>{A.set({type:"error",...e.response.data})})}]}export default class extends e{constructor(e){super(),s(this,e,z,q,t,{data:0})}}
