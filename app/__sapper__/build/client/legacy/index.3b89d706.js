import{_ as n,a as t,b as e,c,i as o,s,d as r,S as i,B as a,Y as f,C as u,f as l,D as p,l as $,E as d,n as g,L as m,G as y,H as h,I as v,k as b,q as w,u as _,an as j,e as N,t as O,K as S,g as x,h as D,j as P,m as R,o as k,F,N as A,J as B,v as C,w as E,x as M,z as L,a3 as U,y as I,X as V,p as q,M as z}from"./client.7a5f01ae.js";function G(n){var c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(n){return!1}}();return function(){var o,s=t(n);if(c){var r=t(this).constructor;o=Reflect.construct(s,arguments,r)}else o=s.apply(this,arguments);return e(this,o)}}function H(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,c)}return e}function J(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?H(Object(e),!0).forEach((function(t){U(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):H(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function K(n){var t,e;return{c:function(){t=N("div"),e=O("Nothing to Sync."),this.h()},l:function(n){t=x(n,"DIV",{style:!0});var c=D(t);e=P(c,"Nothing to Sync."),c.forEach(b),this.h()},h:function(){V(t,"margin","1em 0em")},m:function(n,c){g(n,t,c),k(t,e)},p:q,i:q,o:q,d:function(n){n&&b(t)}}}function T(n){var t,e;return(t=new z({props:{a:{grow:!0},$$slots:{default:[Y]},$$scope:{ctx:n}}})).$on("click",n[5]),{c:function(){u(t.$$.fragment)},l:function(n){p(t.$$.fragment,n)},m:function(n,c){d(t,n,c),e=!0},p:function(n,e){var c={};1024&e&&(c.$$scope={dirty:e,ctx:n}),t.$set(c)},i:function(n){e||(y(t.$$.fragment,n),e=!0)},o:function(n){h(t.$$.fragment,n),e=!1},d:function(n){v(t,n)}}}function X(n){var t,e;return(t=new z({props:{a:{grow:!0},$$slots:{default:[Q]},$$scope:{ctx:n}}})).$on("click",n[6]),{c:function(){u(t.$$.fragment)},l:function(n){p(t.$$.fragment,n)},m:function(n,c){d(t,n,c),e=!0},p:function(n,e){var c={};1024&e&&(c.$$scope={dirty:e,ctx:n}),t.$set(c)},i:function(n){e||(y(t.$$.fragment,n),e=!0)},o:function(n){h(t.$$.fragment,n),e=!1},d:function(n){v(t,n)}}}function Y(n){var t;return{c:function(){t=O("Sync All")},l:function(n){t=P(n,"Sync All")},m:function(n,e){g(n,t,e)},d:function(n){n&&b(t)}}}function Q(n){var t;return{c:function(){t=O("Clear Space")},l:function(n){t=P(n,"Clear Space")},m:function(n,e){g(n,t,e)},d:function(n){n&&b(t)}}}function W(n){var t,e,c,o,s,r,i,a,f,u,p,d,m,v,w,_,j,C,E,M,L,U,I,V,q,z,G=(n[0].matching_files||"None")+"",H=(n[0].differences_found||"None")+"",J=(n[0].files_missing||"None")+"",Y=(n[1]?n[1].length:"N/A")+"",Q=(n[0].errors_while_checking||"None")+"",W=[X,T,K],Z=[];function nn(n,t){return n[0].differences_found||n[0].errors_while_checking||!n[2]||n[0].files_missing||0==n[1].length?0!=n[1].length?1:2:0}return I=nn(n),V=Z[I]=W[I](n),{c:function(){t=N("div"),e=O("Used Memory: "),c=O(n[3]),o=N("br"),s=O("\n    Available Memory: "),r=O(n[4]),i=N("br"),a=O("\n    Synced Files: "),f=O(G),u=N("br"),p=O("\n    Unsynced Files: "),d=O(H),m=O(" ("),v=O(J),w=O(") "),_=N("br"),j=O("\n    Local Files: "),C=O(Y),E=N("br"),M=O(" \n    Notices: "),L=O(Q),U=l(),V.c(),q=S(),this.h()},l:function(l){t=x(l,"DIV",{class:!0});var g=D(t);e=P(g,"Used Memory: "),c=P(g,n[3]),o=x(g,"BR",{}),s=P(g,"\n    Available Memory: "),r=P(g,n[4]),i=x(g,"BR",{}),a=P(g,"\n    Synced Files: "),f=P(g,G),u=x(g,"BR",{}),p=P(g,"\n    Unsynced Files: "),d=P(g,H),m=P(g," ("),v=P(g,J),w=P(g,") "),_=x(g,"BR",{}),j=P(g,"\n    Local Files: "),C=P(g,Y),E=x(g,"BR",{}),M=P(g," \n    Notices: "),L=P(g,Q),g.forEach(b),U=$(l),V.l(l),q=S(),this.h()},h:function(){R(t,"class","pb1")},m:function(n,l){g(n,t,l),k(t,e),k(t,c),k(t,o),k(t,s),k(t,r),k(t,i),k(t,a),k(t,f),k(t,u),k(t,p),k(t,d),k(t,m),k(t,v),k(t,w),k(t,_),k(t,j),k(t,C),k(t,E),k(t,M),k(t,L),g(n,U,l),Z[I].m(n,l),g(n,q,l),z=!0},p:function(n,t){(!z||8&t)&&F(c,n[3]),(!z||16&t)&&F(r,n[4]),(!z||1&t)&&G!==(G=(n[0].matching_files||"None")+"")&&F(f,G),(!z||1&t)&&H!==(H=(n[0].differences_found||"None")+"")&&F(d,H),(!z||1&t)&&J!==(J=(n[0].files_missing||"None")+"")&&F(v,J),(!z||2&t)&&Y!==(Y=(n[1]?n[1].length:"N/A")+"")&&F(C,Y),(!z||1&t)&&Q!==(Q=(n[0].errors_while_checking||"None")+"")&&F(L,Q);var e=I;(I=nn(n))===e?Z[I].p(n,t):(A(),h(Z[e],1,1,(function(){Z[e]=null})),B(),(V=Z[I])||(V=Z[I]=W[I](n)).c(),y(V,1),V.m(q.parentNode,q))},i:function(n){z||(y(V),z=!0)},o:function(n){h(V),z=!1},d:function(n){n&&b(t),n&&b(U),Z[I].d(n),n&&b(q)}}}function Z(n){var t,e,c,o;return t=new a({}),c=new f({props:{a:{grow:!0},className:"p06",$$slots:{default:[W]},$$scope:{ctx:n}}}),{c:function(){u(t.$$.fragment),e=l(),u(c.$$.fragment)},l:function(n){p(t.$$.fragment,n),e=$(n),p(c.$$.fragment,n)},m:function(n,s){d(t,n,s),g(n,e,s),d(c,n,s),o=!0},p:function(n,t){var e=m(t,1)[0],o={};1055&e&&(o.$$scope={dirty:e,ctx:n}),c.$set(o)},i:function(n){o||(y(t.$$.fragment,n),y(c.$$.fragment,n),o=!0)},o:function(n){h(t.$$.fragment,n),h(c.$$.fragment,n),o=!1},d:function(n){v(t,n),n&&b(e),v(c,n)}}}function nn(n,t,e){var c;w(n,I,(function(n){return e(8,c=n)}));var o,s,r,i=t.data,a=void 0===i?{}:i,f=[],u=!1;function l(){return new Promise((function(n,t){M.set({type:"wait",message:"Checking Drive"}),L.get("/sync?as=json",{}).then((function(t){e(0,a=t.data),M.set(null),n(),L.get("/usb/recordings?as=json").then((function(n){e(1,f=n.data),console.log("[sync/index.svelte] 🗄✅  listed local files:",f.length),e(2,u=!0)})).catch((function(n){console.log("[sync/index.svelte] 🗄❌  could not list local files:",n)}))})).catch((function(n){M.set(J({type:"error"},n.response.data)),t()}))}))}return _(C(E.mark((function n(){return E.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l();case 1:case"end":return n.stop()}}),n)})))),n.$$set=function(n){"data"in n&&e(0,a=n.data)},n.$$.update=function(){256&n.$$.dirty&&e(7,o=c.drives.find((function(n){return"/home/pi/pdac/usb"==n._mounted}))||{}),128&n.$$.dirty&&e(3,s=j(1e3*o._used).auto+" ("+o._capacity+")"),128&n.$$.dirty&&e(4,r=j(1e3*o._available).auto)},[a,f,u,s,r,function(){M.set({type:"wait",message:"Syncing Files<br />Please wait..."}),L.post("/sync?as=json",{}).then((function(n){l().finally((function(){M.set({type:"success",message:n.data,actions:[["Sessions","/session"],["Close","/sync"]]})}))})).catch((function(n){M.set(J({type:"error"},n.response.data))}))},function(){M.set({type:"wait",message:"Deleting Local Files"}),L.post("/sync/clearup?as=json",{}).then((function(n){console.log(n),setTimeout((function(){l().finally((function(){M.set(null)}))}),1e3)})).catch((function(n){M.set(J({type:"error"},n.response.data))}))}]}var tn=function(t){n(a,i);var e=G(a);function a(n){var t;return c(this,a),t=e.call(this),o(r(t),n,nn,Z,s,{data:0}),t}return a}();export default tn;
