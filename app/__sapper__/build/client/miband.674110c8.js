import{A as n,S as e,i as t,s as a,B as s,R as o,w as c,a as r,x as d,g as i,y as $,j as l,z as m,C as f,D as u,f as g,l as p,ab as b,K as y,L as M,I as h,e as w,t as k,c as x,b as C,d as I,k as N,v as S,M as _,r as j,p as v,q as B}from"./client.bed04d7c.js";import{I as D}from"./IndexDropdown.d3305ecb.js";function E(n){let e;return{c(){e=k("Change MiBand")},l(n){e=I(n,"Change MiBand")},m(n,t){l(n,e,t)},d(n){n&&g(e)}}}function O(n){let e;return{c(){e=k("Reconnect MiBand")},l(n){e=I(n,"Reconnect MiBand")},m(n,t){l(n,e,t)},d(n){n&&g(e)}}}function R(n){let e,t,a,s,o,p,b,j,v,B,R,V,q,z,K,L,F,G,H,J,P=(n[1]?n[1].number:"NONE")+"",Q=(n[1]?n[1].mac_address:"~")+"",T=n[2].backend.miband.initialised?"Initialised":"Not Initialised",U=n[2].backend.miband.connected?"Connected":"Not Connected";function W(e){n[6].call(null,e)}let X={};return void 0!==n[0]&&(X.a=n[0]),z=new D({props:X}),y.push(()=>M(z,"a",W)),z.$on("change",A),F=new h({props:{a:{grow:!0},$$slots:{default:[E]},$$scope:{ctx:n}}}),F.$on("click",n[3]),H=new h({props:{a:{grow:!0},$$slots:{default:[O]},$$scope:{ctx:n}}}),H.$on("click",n[4]),{c(){e=w("div"),t=k("Current MiBand: "),a=k(P),s=k(" ( "),o=k(Q),p=k(" )"),b=r(),j=w("div"),v=k("Status: \n    "),B=k(T),R=r(),V=k(U),q=r(),c(z.$$.fragment),L=r(),c(F.$$.fragment),G=r(),c(H.$$.fragment)},l(n){e=x(n,"DIV",{});var c=C(e);t=I(c,"Current MiBand: "),a=I(c,P),s=I(c," ( "),o=I(c,Q),p=I(c," )"),c.forEach(g),b=i(n),j=x(n,"DIV",{});var r=C(j);v=I(r,"Status: \n    "),B=I(r,T),R=i(r),V=I(r,U),r.forEach(g),q=i(n),d(z.$$.fragment,n),L=i(n),d(F.$$.fragment,n),G=i(n),d(H.$$.fragment,n)},m(n,c){l(n,e,c),N(e,t),N(e,a),N(e,s),N(e,o),N(e,p),l(n,b,c),l(n,j,c),N(j,v),N(j,B),N(j,R),N(j,V),l(n,q,c),$(z,n,c),l(n,L,c),$(F,n,c),l(n,G,c),$(H,n,c),J=!0},p(n,e){(!J||2&e)&&P!==(P=(n[1]?n[1].number:"NONE")+"")&&S(a,P),(!J||2&e)&&Q!==(Q=(n[1]?n[1].mac_address:"~")+"")&&S(o,Q),(!J||4&e)&&T!==(T=n[2].backend.miband.initialised?"Initialised":"Not Initialised")&&S(B,T),(!J||4&e)&&U!==(U=n[2].backend.miband.connected?"Connected":"Not Connected")&&S(V,U);const t={};!K&&1&e&&(K=!0,t.a=n[0],_(()=>K=!1)),z.$set(t);const s={};128&e&&(s.$$scope={dirty:e,ctx:n}),F.$set(s);const c={};128&e&&(c.$$scope={dirty:e,ctx:n}),H.$set(c)},i(n){J||(m(z.$$.fragment,n),m(F.$$.fragment,n),m(H.$$.fragment,n),J=!0)},o(n){f(z.$$.fragment,n),f(F.$$.fragment,n),f(H.$$.fragment,n),J=!1},d(n){n&&g(e),n&&g(b),n&&g(j),n&&g(q),u(z,n),n&&g(L),u(F,n),n&&g(G),u(H,n)}}}function V(n){let e,t,a,p;return e=new s({}),a=new o({props:{className:"mlr06 pb1",a:{grow:!0},$$slots:{default:[R]},$$scope:{ctx:n}}}),{c(){c(e.$$.fragment),t=r(),c(a.$$.fragment)},l(n){d(e.$$.fragment,n),t=i(n),d(a.$$.fragment,n)},m(n,s){$(e,n,s),l(n,t,s),$(a,n,s),p=!0},p(n,[e]){const t={};135&e&&(t.$$scope={dirty:e,ctx:n}),a.$set(t)},i(n){p||(m(e.$$.fragment,n),m(a.$$.fragment,n),p=!0)},o(n){f(e.$$.fragment,n),f(a.$$.fragment,n),p=!1},d(n){u(e,n),n&&g(t),u(a,n)}}}async function q(e,t){return n(e,t,this)}function z(n){return n?n.replace(/(\r\n|\n|\r)/gm,"").trim():""}function A(){}function K(n,e,t){let a;p(n,v,n=>t(2,a=n));let s,{data:o}=e,c={options:b,key:"number",grow:!0};return n.$$set=n=>{"data"in n&&t(5,o=n.data)},n.$$.update=()=>{4&n.$$.dirty&&t(1,s=b.find(n=>z(n.mac_address)===z(a.backend.mac_address)))},[c,s,a,function(){let n=b[c.value];console.log(n),n&&j.post("/system/miband?as=json",{mac_address:n.mac_address}).then(e=>{console.log("[Miband] ⌚️✅  Miband updated...",n.mac_address,n.number),v.grab()}).catch(n=>{console.log("[Miband] ⌚️❌ could not update ",n.toString(),Object.keys(n),n.response),B.set({type:"error",...n.response.data})})},function(){console.log("[Session] ⌚️  Miband reconnecting..."),B.set({type:"wait",message:"Reconnecting to "+s.mac_address}),j.post("/system/miband/reconnect?as=json",{}).then(n=>{console.log("[Session] ⌚️✅  Miband connected"),B.set(null)}).catch(n=>{console.log("[Session] ⌚️❌ Miband could not reconnect ",n.toString(),Object.keys(n),n.response),B.set({type:"error",...n.response.data})})},o,function(n){c=n,t(0,c)}]}export default class extends e{constructor(n){super(),t(this,n,K,V,a,{data:5})}}export{q as preload};
